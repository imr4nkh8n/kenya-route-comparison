<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kenya Truck Route Performance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Chart.js + Zoom -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>

<style>
:root{
  --bg:#0b0f19;
  --card:rgba(255,255,255,0.08);
  --border:rgba(255,255,255,0.18);
  --cyan:#00f0ff;
  --green:#22c55e;
  --red:#ef4444;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,Arial;
  background:radial-gradient(circle at top,#111827,#020617);
  color:#e5e7eb;
}

.container{
  max-width:1600px;
  margin:auto;
  padding:24px;
}

h1{
  text-align:center;
  font-weight:600;
  margin-bottom:20px;
}

.controls{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  justify-content:center;
  margin-bottom:18px;
}

.controls select,
.controls input{
  padding:10px;
  border-radius:10px;
  border:none;
  background:#020617;
  color:#e5e7eb;
}

.controls button{
  padding:12px 24px;
  border:none;
  border-radius:12px;
  font-weight:600;
  background:linear-gradient(135deg,#00f0ff,#38bdf8);
  color:#020617;
  cursor:pointer;
}

.dashboard{
  display:grid;
  grid-template-columns:repeat(12,1fr);
  grid-auto-rows:minmax(140px,auto);
  gap:18px;
}

.card{
  backdrop-filter:blur(18px);
  background:linear-gradient(
    135deg,
    rgba(255,255,255,0.14),
    rgba(255,255,255,0.04)
  );
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
}

.kpis{grid-column:1/-1;display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.kpi{text-align:center}
.kpi h3{font-size:0.9rem;margin:0;color:#9ca3af}
.kpi p{font-size:1.4rem;margin:6px 0;font-weight:600}

.elevation{grid-column:1/5}
.speed{grid-column:5/-1}
.fuel{grid-column:1/7}
.gear{grid-column:7/-1}
.summary{grid-column:1/-1}

canvas{width:100%!important;height:320px!important}

table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.15);
  text-align:center;
}
th{color:#9ca3af;font-weight:500}
.good{color:var(--green);font-weight:600}

@media(max-width:900px){
  .dashboard{grid-template-columns:1fr}
  .kpis{grid-template-columns:1fr 1fr}
  .elevation,.speed,.fuel,.gear{grid-column:1/-1}
}
</style>
</head>

<body>
<div class="container">
<h1>Kenya Truck Route Performance Dashboard</h1>

<div class="controls">
  <select id="route">
    <option value="nairobi-nakuru">Nairobi → Nakuru</option>
    <option value="nairobi-mombasa">Nairobi → Mombasa</option>
    <option value="nairobi-eldoret">Nairobi → Eldoret</option>
  </select>

  <select id="truck">
    <option value="fuso">Fuso FI 1217R</option>
    <option value="isuzu">Isuzu FRR90N</option>
  </select>

  <label>Payload (t)
    <input type="range" id="payload" min="8" max="12" value="10">
  </label>

  <input type="number" id="diesel" value="171.4" step="0.1">
  <input type="number" id="hire" value="350000">

  <button onclick="generate()">Generate Dashboard</button>
</div>

<div class="dashboard">

  <div class="card kpis">
    <div class="kpi"><h3>Distance</h3><p id="kpiDist">–</p></div>
    <div class="kpi"><h3>Avg Speed</h3><p id="kpiSpeed">–</p></div>
    <div class="kpi"><h3>Fuel Cost</h3><p id="kpiFuel">–</p></div>
    <div class="kpi"><h3>Trip Profit</h3><p id="kpiProfit">–</p></div>
  </div>

  <div class="card elevation"><canvas id="elevChart"></canvas></div>
  <div class="card speed"><canvas id="speedChart"></canvas></div>
  <div class="card fuel"><canvas id="fuelChart"></canvas></div>
  <div class="card gear"><canvas id="gearChart"></canvas></div>

  <div class="card summary">
    <table id="summary"></table>
  </div>

</div>
</div>

<script>
Chart.register(ChartZoom);

let charts=[];

const routes={
  "nairobi-nakuru":{dist:160,elev:[1795,1800,1820,1900,2100,2350,2600,2850,3050,2900,2600,2300,2000,1800,1730]},
  "nairobi-mombasa":{dist:480,elev:[1795,1900,2200,2600,3000,3400,3000,2600,2200,1800,1400,1000,600,200]},
  "nairobi-eldoret":{dist:320,elev:[1795,2000,2400,2600,2300,2000,1700,1400,1100]}
};

const trucks={
  fuso:{mass:24800,crr:0.006,eff:0.38},
  isuzu:{mass:21000,crr:0.007,eff:0.36}
};

function resetCharts(){
  charts.forEach(c=>c.destroy());
  charts=[];
}

function generate(){
  resetCharts();

  const r=routes[route.value];
  const t=trucks[truck.value];
  const payloadKg=payload.value*1000;
  const dieselCost=+diesel.value;
  const hireRate=+hire.value;

  const step=r.dist/(r.elev.length-1);
  let speeds=[],fuel=[];
  let totalFuel=0;

  for(let i=0;i<r.elev.length;i++){
    let grade=i? (r.elev[i]-r.elev[i-1])/(step*1000):0;
    let speed=80-Math.max(0,grade*300);
    if(speed<40)speed=40;
    speeds.push(speed);

    let force=(t.mass+payloadKg)*9.81*(grade+t.crr);
    let power=force*(speed/3.6)/1000;
    let f=(power/(t.eff*36))*dieselCost;
    fuel.push(f);
    totalFuel+=f*step;
  }

  const avgSpeed=speeds.reduce((a,b)=>a+b)/speeds.length;
  const profit=hireRate-totalFuel;

  kpiDist.innerText=`${r.dist} km`;
  kpiSpeed.innerText=`${avgSpeed.toFixed(1)} km/h`;
  kpiFuel.innerText=`KES ${totalFuel.toFixed(0)}`;
  kpiProfit.innerText=`KES ${profit.toFixed(0)}`;

  charts.push(new Chart(elevChart,{
    type:"line",
    data:{labels:r.elev.map((_,i)=>Math.round(i*step)),
      datasets:[{label:"Elevation (m)",data:r.elev,borderColor:"#38bdf8",borderWidth:1.5}]},
    options:{plugins:{title:{display:true,text:"Elevation Profile"},zoom:{zoom:{wheel:{enabled:true},pinch:{enabled:true}}}},
      scales:{x:{title:{display:true,text:"Distance (km)"}},y:{title:{display:true,text:"m"}}}}
  }));

  charts.push(new Chart(speedChart,{
    type:"line",
    data:{labels:r.elev.map((_,i)=>Math.round(i*step)),
      datasets:[{label:"Speed (km/h)",data:speeds,borderColor:"#22c55e",borderWidth:1.5}]},
    options:{plugins:{title:{display:true,text:"Speed vs Distance"},zoom:{zoom:{wheel:{enabled:true}}}},
      scales:{x:{title:{display:true,text:"Distance (km)"}},y:{title:{display:true,text:"km/h"}}}}
  }));

  charts.push(new Chart(fuelChart,{
    type:"line",
    data:{labels:r.elev.map((_,i)=>Math.round(i*step)),
      datasets:[{label:"Fuel Cost (KES/km)",data:fuel,borderColor:"#ef4444",borderWidth:1.5}]},
    options:{plugins:{title:{display:true,text:"Fuel Intensity"},zoom:{zoom:{wheel:{enabled:true}}}},
      scales:{x:{title:{display:true,text:"Distance (km)"}},y:{title:{display:true,text:"KES/km"}}}}
  }));

  charts.push(new Chart(gearChart,{
    type:"bar",
    data:{labels:["1","2","3","4","5","6"],
      datasets:[{label:"Gear Usage (placeholder)",data:[5,12,22,30,20,11],backgroundColor:"#00f0ff"}]},
    options:{plugins:{title:{display:true,text:"Gear Usage (Phase C placeholder)"}}}
  }));

  summary.innerHTML=`
    <tr><th>Metric</th><th>${truck.options[truck.selectedIndex].text}</th></tr>
    <tr><td>Fuel Cost</td><td class="good">KES ${totalFuel.toFixed(0)}</td></tr>
    <tr><td>Avg Speed</td><td>${avgSpeed.toFixed(1)} km/h</td></tr>
    <tr><td>Trip Profit</td><td class="good">KES ${profit.toFixed(0)}</td></tr>
    <tr><td colspan="2">Maintains higher climb speed with lower fuel penalty on Kenyan gradients.</td></tr>
  `;
}
</script>
</body>
</html>
