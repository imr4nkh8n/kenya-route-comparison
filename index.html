<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kenya Truck Route Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Inter', Arial, sans-serif; margin:0; background:#0e1117; color:#e5e7eb; }
  .container { max-width:1400px; margin:auto; padding:20px; }
  h2,h3 { text-align:center; color:#00f0ff; }
  select,input { padding:8px; margin:4px; border-radius:6px; border:none; font-size:1rem; }
  button { padding:10px 20px; margin:10px 0; background:#00f0ff; color:#0e1117; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
  .dashboard { display:grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap:20px; margin-top:20px; }
  .card { background:rgba(255,255,255,0.05); border-radius:12px; padding:15px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,0.4); }
  canvas { background:#0e1117; border-radius:12px; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th,td { border:1px solid #374151; padding:8px; text-align:center; }
  th { background:#1f2937; }
  .good { background:#064e3b; }
  @media(max-width:768px){ .dashboard{grid-template-columns:1fr;} }
</style>
</head>
<body>

<div class="container">
  <h2>Kenya Truck Route Dashboard</h2>

  <div style="text-align:center;">
    <label>Route: </label>
    <select id="route">
      <option value="nairobi-nakuru">Nairobi ↔ Nakuru</option>
      <option value="nairobi-mombasa">Nairobi ↔ Mombasa</option>
      <option value="nairobi-eldoret">Nairobi ↔ Eldoret</option>
      <option value="nairobi-kisumu">Nairobi ↔ Kisumu</option>
      <option value="nairobi-namanga">Nairobi ↔ Namanga</option>
    </select>

    <label>Payload (t): </label>
    <input type="range" id="payload" min="8" max="12" value="10">
    <span id="payloadVal">10</span>

    <label>Diesel Price (KES/L): </label>
    <input type="number" id="diesel" value="171.4">

    <label>Hire Rate (KES/trip): </label>
    <input type="number" id="hire" value="350000">
    <br>
    <button onclick="runDashboard()">Generate Dashboard</button>
  </div>

  <div class="dashboard">
    <div class="card"><h3>Trip Time (hrs)</h3><p id="kpiTime">--</p></div>
    <div class="card"><h3>Total Fuel Cost (KES)</h3><p id="kpiFuel">--</p></div>
    <div class="card"><h3>Trip Profit (KES)</h3><p id="kpiProfit">--</p></div>
    <div class="card"><h3>Average Speed (km/h)</h3><p id="kpiSpeed">--</p></div>
  </div>

  <div class="dashboard">
    <div class="card"><canvas id="elevChart"></canvas></div>
    <div class="card"><canvas id="speedChart"></canvas></div>
    <div class="card"><canvas id="fuelChart"></canvas></div>
  </div>

  <table id="summary"></table>
</div>

<script>
document.getElementById("payload").oninput=function(){
  document.getElementById("payloadVal").innerText=this.value;
};

// Preloaded route distances and synthetic elevations
const routes = {
  "nairobi-nakuru": {distance:160, elev:[1795,1800,1810,1830,1860,1920,2000,2150,2300,2450,2600,2750,2900,3050,3000,2900,2750,2600,2450,2300,2150,2000,1900,1850,1800,1780,1760,1750,1740,1735,1730,1725,1720]},
  "nairobi-mombasa": {distance:480, elev:[1795,1820,1900,2050,2200,2500,2700,3000,3100,3200,3300,3400,3500,3400,3200,3000,2800,2600,2400,2200,2000,1900,1850,1800,1750,1700,1650,1600,1550,1500,1450,1400,1350,1300,1250,1200,1150,1100,1050,1000,950,900,850,800,780,760,740,720,700,680,660,640,620,600,580,560,540,520,500,480,460,440,420,400,380,360,340,320,300,280,260,240,220,200,180,160,150,140,130,120,110,100,90,80,70,60,50,40,30,20,10,0]},
  "nairobi-eldoret": {distance:320, elev:[1795,1820,1900,2000,2100,2200,2300,2400,2500,2450,2400,2350,2300,2250,2200,2150,2100,2050,2000,1950,1900,1850,1800,1750,1700,1650,1600,1550,1500,1450,1400,1350,1300,1250,1200,1150,1100,1050,1000,950,900,850,800,780,760,740,720,700,680,660,640,620,600,580,560,540,520,500,480,460,440,420,400,380,360,340,320,300,280,260,240,220,200,180,160,150,140,130,120,110,100,90,80,70,60,50,40,30,20,10,0]},
  "nairobi-kisumu": {distance:350, elev:[1795,1805,1820,1840,1865,1890,1920,1950,1980,2010,2040,2070,2100,2080,2050,2020,1990,1960,1930,1900,1870,1840,1810,1780,1750,1720,1700,1680,1650,1620,1600,1580,1550,1520,1500,1480,1450,1420,1400,1380,1350,1320,1300,1280,1250,1220,1200,1180,1150,1120,1100,1080,1050,1020,1000,980,960,940,920,900,880,860,840,820,800,780,760,740,720,700,680,660,640,620,600,580,560,540,520,500,480,460,440,420,400,380,360,340,320,300,280,260,240,220,200,180,160,140,120,100,80,60,40,20,0]},
  "nairobi-namanga": {distance:230, elev:[1795,1800,1820,1850,1900,1950,2000,2050,2100,2080,2050,2020,1990,1960,1930,1900,1870,1840,1810,1780,1750,1720,1700,1680,1650,1620,1600,1580,1550,1520,1500,1480,1450,1420,1400,1380,1350,1320,1300,1280,1250,1220,1200,1180,1150,1120,1100,1080,1050,1020,1000,980,960,940,920,900,880,860,840,820,800,780,760,740,720,700,680,660,640,620,600,580,560,540,520,500,480,460,440,420,400,380,360,340,320,300,280,260,240,220,200,180,160,140,120,100,80,60,40,20,0]}
};

// Two trucks
const trucks = {
  fuso:{name:"Fuso FI 1217R",mass:24800,eff:0.38,crr:0.006,baseSpeed:80},
  isuzu:{name:"Isuzu FRR90N",mass:21000,eff:0.36,crr:0.007,baseSpeed:80}
};

function simulate(truck,payload,diesel,elev){
  const n=elev.length;
  let speed=[], fuel=[];
  for(let i=0;i<n;i++){
    let s=truck.baseSpeed;
    if(i>0 && (elev[i]-elev[i-1])/5 > 0.05) s-=10;
    if(payload>10000 && i>0 && (elev[i]-elev[i-1])/5>0.05) s-=5;
    if(s<40) s=40;
    speed.push(s);

    const force=(truck.mass+payload)*9.81*((i>0? (elev[i]-elev[i-1])/5000 :0))+ (truck.mass+payload)*9.81*truck.crr;
    const power=(force*(s/3.6))/1000;
    const f=(power/(truck.eff*36))*diesel;
    fuel.push(f);
  }
  return {speed,fuel};
}

function runDashboard(){
  const routeSel=document.getElementById("route").value;
  const routeData=routes[routeSel];
  const distance=routeData.distance;
  const elev=routeData.elev;

  const payload=parseFloat(document.getElementById("payload").value)*1000;
  const diesel=parseFloat(document.getElementById("diesel").value);
  const hire=parseFloat(document.getElementById("hire").value);

  const fuso=simulate(trucks.fuso,payload,diesel,elev);
  const isuzu=simulate(trucks.isuzu,payload,diesel,elev);

  // Charts
  new Chart(elevChart,{
    type:"line",
    data:{labels:elev.map((_,i)=>i*5),datasets:[{label:"Elevation (m)",data:elev,borderColor:"#38bdf8",fill:false}]},
    options:{plugins:{title:{display:true,text:"Elevation Profile"}},scales:{x:{title:{display:true,text:"Distance (km)"}},y:{title:{display:true,text:"m"}}}}
  });

  new Chart(speedChart,{
    type:"line",
    data:{labels:elev.map((_,i)=>i*5),datasets:[
      {label:"Fuso Speed",data:fuso.speed,borderColor:"#22c55e",fill:false},
      {label:"Isuzu Speed",data:isuzu.speed,borderColor:"#ef4444",fill:false}
    ]},
    options:{plugins:{title:{display:true,text:"Speed vs Distance"}},scales:{x:{title:{display:true,text:"Distance (km)"}},y:{title:{display:true,text:"km/h"}}}}
  });

  new Chart(fuelChart,{
    type:"line",
    data:{labels:elev.map((_,i)=>i*5),datasets:[
      {label:"Fuso Fuel KES/km",data:fuso.fuel,borderColor:"#16a34a",fill:false},
      {label:"Isuzu Fuel KES/km",data:isuzu.fuel,borderColor:"#dc2626",fill:false}
    ]},
    options:{plugins:{title:{display:true,text:"Fuel Intensity"}},scales:{x:{title:{display:true,text:"Distance (km)"}},y:{title:{display:true,text:"KES/km"}}}}
  });

  // KPIs
  const fusoTotalFuel=fuso.fuel.reduce((a,b)=>a+b,0)*5;
  const isuzuTotalFuel=isuzu.fuel.reduce((a,b)=>a+b,0)*5;
  const fusoTime=(distance/fuso.speed.reduce((a,b)=>a+b,0)*1.0*elev.length/5).toFixed(1);
  const isuzuTime=(distance/isuzu.speed.reduce((a,b)=>a+b,0)*1.0*elev.length/5).toFixed(1);

  kpiTime.innerText=`Fuso: ${fusoTime} | Isuzu: ${isuzuTime}`;
  kpiFuel.innerText=`Fuso: KES ${fusoTotalFuel.toFixed(0)} | Isuzu: KES ${isuzuTotalFuel.toFixed(0)}`;
  kpiProfit.innerText=`Fuso: KES ${(hire-fusoTotalFuel).toFixed(0)} | Isuzu: KES ${(hire-isuzuTotalFuel).toFixed(0)}`;
  kpiSpeed.innerText=`Fuso: ${Math.round(fuso.speed.reduce((a,b)=>a+b,0)/fuso.speed.length)} | Isuzu: ${Math.round(isuzu.speed.reduce((a,b)=>a+b,0)/isuzu.speed.length)}`;

  summary.innerHTML=`<tr><th>Metric</th><th>Fuso</th><th>Isuzu</th></tr>
    <tr><td>Total Fuel Cost</td><td class='good'>KES ${fusoTotalFuel.toFixed(0)}</td><td>KES ${isuzuTotalFuel.toFixed(0)}</td></tr>
    <tr><td>Trip Profit</td><td class='good'>KES ${(hire-fusoTotalFuel).toFixed(0)}</td><td>KES ${(hire-isuzuTotalFuel).toFixed(0)}</td></tr>`;
}
</script>

</body>
</html>
